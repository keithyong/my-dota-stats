
var server = http.createServer(function (req, res) {
    console.log("Recieved request: " + req.url);
    if (req.url === '/') {
        call_jsdom("index.html", function(window) {
            var $ = window.$;
            dotadb.getLatestDotaMatch(function(match) {
                console.log("Found latest match! Match: " + match);
                var hours = matchDetails.getHoursSinceGameWasPlayed(match.match_time, match.match_duration).toFixed(1);
                console.log("Found the latest match: " + match.match_id);
                
                /* Write to the HTML file with JQuery */
                res.writeHead(202, {'Content-Type': 'text/html'});
                $("#hours_ago").text(hours);
                res.end("<!DOCTYPE html>\n" + $('html').html());
            });
        });
    } else {
        /* End the request if it's something other than '/' */
        res.end();
    }
}).listen(port, ip);

